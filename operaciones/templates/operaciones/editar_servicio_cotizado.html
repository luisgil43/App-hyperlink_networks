{% extends "dashboard_admin/base.html" %}
{% load widget_tweaks %}
{% load custom_filters %}

{% block title %}Editar Cotizaci√≥n{% endblock %}

{% block dashboard_content %}
<div class="max-w-3xl mx-auto bg-white p-6 rounded-2xl shadow mt-6">
  <h2 class="text-2xl font-bold text-gray-800 mb-6">‚úèÔ∏è Editar Cotizaci√≥n</h2>

  <form method="post">
    {% csrf_token %}
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <label class="block text-sm font-medium text-gray-700">ID CLARO</label>
        {{ form.id_claro|add_class:"w-full border rounded-xl px-3 py-2"|attr:"id:id_claro" }}
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Regi√≥n</label>
        {{ form.region|add_class:"w-full border rounded-xl px-3 py-2"|attr:"id:id_region" }}
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Mes Producci√≥n</label>
        {{ form.mes_produccion|add_class:"w-full border rounded-xl px-3 py-2" }}
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">ID NEW</label>
        {{ form.id_new|add_class:"w-full border rounded-xl px-3 py-2"|attr:"id:id_id_new" }}
      </div>
      <div class="md:col-span-2">
        <label class="block text-sm font-medium text-gray-700">Detalle Tarea</label>
        {{ form.detalle_tarea|add_class:"w-full border rounded-xl px-3 py-2" }}
      </div>

      <!-- Monto Cotizado (UF) -->
   <div class="md:col-span-2">
    <label class="block text-sm font-medium text-gray-700">Monto Cotizado (UF)</label>
    <input type="text"
           name="monto_cotizado"
           value="{{ form.data.monto_cotizado|default:servicio.monto_cotizado|stringformat:'.2f'|default:'' }}"
           class="w-full border rounded-xl px-3 py-2">
    {% if form.errors.monto_cotizado %}
        <p class="text-red-600 text-sm mt-1">{{ form.errors.monto_cotizado.0 }}</p>
    {% endif %}
</div>

<div class="md:col-span-2">
    <label class="block text-sm font-medium text-gray-700">Monto MMOO (CLP)</label>
    <input type="text"
           name="monto_mmoo"
           value="{{ form.data.monto_mmoo|default:servicio.monto_mmoo|default:'' }}"
           class="w-full border rounded-xl px-3 py-2">
    {% if form.errors.monto_mmoo %}
        <p class="text-red-600 text-sm mt-1">{{ form.errors.monto_mmoo.0 }}</p>
    {% endif %}
</div>
    </div>

    <div class="mt-6 flex justify-between items-center">
      <a href="{% url 'operaciones:listar_servicios_pm' %}" class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-5 py-2 rounded-xl font-semibold">
        ‚Üê Volver
      </a>
      <button type="submit" class="bg-emerald-600 hover:bg-emerald-700 text-white px-6 py-2 rounded-xl font-semibold">
        üíæ Guardar
      </button>
    </div>
  </form>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const idClaroInput = document.getElementById("id_claro");
    idClaroInput.addEventListener("blur", function () {
      const id_claro = idClaroInput.value.trim();
      if (id_claro) {
        fetch(`/operaciones/ajax/obtener-datos-sitio/?id_claro=${id_claro}`)
          .then(response => response.json())
          .then(data => {
            if (data.region && data.id_new) {
              document.getElementById("id_region").value = data.region;
              document.getElementById("id_id_new").value = data.id_new;
            } else {
              alert("No se encontr√≥ informaci√≥n para este ID Claro.");
            }
          })
          .catch(error => console.error("Error al buscar datos:", error));
      }
    });
  });
</script>
{% endblock %}
