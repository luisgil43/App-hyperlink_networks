{% extends "dashboard_admin/base.html" %}
{% load static %}

{% block dashboard_content %}
<div class="max-w-3xl mx-auto bg-white p-6 rounded-xl shadow-lg mt-6">
  <h2 class="text-2xl font-bold mb-4 flex items-center gap-2">
    <i class="lucide lucide-pen-line text-green-600"></i>
    Subir Firma del Representante Legal
  </h2>

  <form method="post">
    {% csrf_token %}
    <div class="mb-6">
      <label class="block text-sm font-medium text-gray-700 mb-2">Firma:</label>
      <canvas id="canvas" width="400" height="150" class="border border-gray-300 rounded-md shadow-sm bg-white"></canvas>
    </div>

    <input type="hidden" name="firma_digital" id="firma_digital">

    <div class="flex gap-4">
      <button type="submit" onclick="guardarFirma()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg shadow">
        Guardar Firma
      </button>
      <button type="button" onclick="limpiarFirma()" class="bg-gray-300 hover:bg-gray-400 text-gray-800 px-4 py-2 rounded-lg shadow">
        Limpiar
      </button>
    </div>
  </form>
</div>

<script>
  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d');
  let dibujando = false;

  canvas.addEventListener('mousedown', e => {
    dibujando = true;
    ctx.beginPath();
    ctx.moveTo(e.offsetX, e.offsetY);
  });

  canvas.addEventListener('mousemove', e => {
    if (dibujando) {
      ctx.lineTo(e.offsetX, e.offsetY);
      ctx.stroke();
    }
  });

  canvas.addEventListener('mouseup', () => {
    dibujando = false;
  });

  function limpiarFirma() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
  }

  function guardarFirma() {
    const dataURL = canvas.toDataURL('image/png');
    document.getElementById('firma_digital').value = dataURL;
  }
</script>
{% endblock %}
