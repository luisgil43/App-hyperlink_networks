{% extends 'dashboard_admin/base.html' %}
{% load widget_tweaks %}

{% block dashboard_content %}
<div class="max-w-5xl mx-auto bg-white p-6 rounded-2xl shadow-md">
  <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center gap-2">
    <i class="lucide lucide-user-cog text-blue-600"></i>
    Editar Ficha de Ingreso
  </h2>

  <form method="POST" enctype="multipart/form-data" class="space-y-8">
    {% csrf_token %}
    {{ form.non_field_errors }}

    <!-- DATOS PERSONALES -->
    <h3 class="text-lg font-semibold text-gray-700 border-b pb-1">Datos personales</h3>
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
      {% include "rrhh/campo_formulario.html" with field=form.nombres %}
      {% include "rrhh/campo_formulario.html" with field=form.apellidos %}
      {% include "rrhh/campo_formulario.html" with field=form.rut %}
      {% include "rrhh/campo_formulario.html" with field=form.fecha_nacimiento %}
      {% include "rrhh/campo_formulario.html" with field=form.edad %}
      {% include "rrhh/campo_formulario.html" with field=form.sexo %}
      {% include "rrhh/campo_formulario.html" with field=form.estado_civil %}
      {% include "rrhh/campo_formulario.html" with field=form.nacionalidad %}
      {% include "rrhh/campo_formulario.html" with field=form.hijos %}
      {% include "rrhh/campo_formulario.html" with field=form.nivel_estudios %}
      {% include "rrhh/campo_formulario.html" with field=form.profesion_u_oficio %}
    </div>

    <!-- DOMICILIO -->
    <h3 class="text-lg font-semibold text-gray-700 border-b pb-1">Domicilio</h3>
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
      {% include "rrhh/campo_formulario.html" with field=form.direccion %}
      {% include "rrhh/campo_formulario.html" with field=form.comuna %}
      {% include "rrhh/campo_formulario.html" with field=form.region %}
    </div>

    <!-- CONTACTO -->
    <h3 class="text-lg font-semibold text-gray-700 border-b pb-1">Contacto</h3>
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
      {% include "rrhh/campo_formulario.html" with field=form.telefono %}
      {% include "rrhh/campo_formulario.html" with field=form.email %}
    </div>

    <!-- CONTACTO DE EMERGENCIA -->
    <h3 class="text-lg font-semibold text-gray-700 border-b pb-1">Contacto de emergencia</h3>
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
      {% include "rrhh/campo_formulario.html" with field=form.nombre_contacto_emergencia %}
      {% include "rrhh/campo_formulario.html" with field=form.telefono_emergencia %}
      {% include "rrhh/campo_formulario.html" with field=form.parentesco_emergencia %}
      {% include "rrhh/campo_formulario.html" with field=form.direccion_emergencia %}
    </div>

    <!-- PREVISI√ìN Y SALUD -->
    <h3 class="text-lg font-semibold text-gray-700 border-b pb-1">Previsi√≥n y salud</h3>
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
      {% include "rrhh/campo_formulario.html" with field=form.afp %}
      {% include "rrhh/campo_formulario.html" with field=form.salud %}
    </div>

    <!-- DATOS BANCARIOS -->
    <h3 class="text-lg font-semibold text-gray-700 border-b pb-1">Datos bancarios</h3>
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-4">
      {% include "rrhh/campo_formulario.html" with field=form.banco %}
      {% include "rrhh/campo_formulario.html" with field=form.tipo_cuenta %}
      {% include "rrhh/campo_formulario.html" with field=form.numero_cuenta %}
    </div>
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
      {% include "rrhh/campo_formulario.html" with field=form.banco_2 %}
      {% include "rrhh/campo_formulario.html" with field=form.tipo_cuenta_2 %}
      {% include "rrhh/campo_formulario.html" with field=form.numero_cuenta_2 %}
    </div>

    <!-- INFORMACI√ìN LABORAL -->
    <h3 class="text-lg font-semibold text-gray-700 border-b pb-1">Informaci√≥n laboral</h3>
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
      {% include "rrhh/campo_formulario.html" with field=form.cargo %}
      {% include "rrhh/campo_formulario.html" with field=form.jefe_directo %}
      {% include "rrhh/campo_formulario.html" with field=form.proyecto %}
      {% include "rrhh/campo_formulario.html" with field=form.fecha_inicio %}
      {% include "rrhh/campo_formulario.html" with field=form.tipo_contrato %}
      {% include "rrhh/campo_formulario.html" with field=form.jornada %}
      {% include "rrhh/campo_formulario.html" with field=form.sueldo_base %}
      {% include "rrhh/campo_formulario.html" with field=form.bono %}
      {% include "rrhh/campo_formulario.html" with field=form.colacion %}
      {% include "rrhh/campo_formulario.html" with field=form.movilizacion %}
    </div>

    <!-- TALLAS -->
    <h3 class="text-lg font-semibold text-gray-700 border-b pb-1">Tallas</h3>
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
      {% include "rrhh/campo_formulario.html" with field=form.talla_polera %}
      {% include "rrhh/campo_formulario.html" with field=form.talla_pantalon %}
      {% include "rrhh/campo_formulario.html" with field=form.talla_zapato %}
      {% include "rrhh/campo_formulario.html" with field=form.observaciones %}
    </div>

    <!-- BOTONES -->
    <div class="flex flex-col sm:flex-row justify-between items-center gap-4 mt-6">
      <a href="{% url 'rrhh:listar_fichas_ingreso_admin' %}"
         class="text-gray-700 border border-gray-300 hover:bg-gray-100 px-6 py-2 rounded shadow text-sm sm:text-base">
        ‚Üê Volver
      </a>
      <button type="submit"
        class="w-full sm:w-auto bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded font-semibold shadow">
        Guardar cambios
      </button>
    </div>
  </form>
</div>

<!-- üß† Inputmask para m√°scaras visuales -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/inputmask/5.0.8/inputmask.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    // Solo letras
    Inputmask({ regex: "[A-Za-z√Å√â√ç√ì√ö√ë√°√©√≠√≥√∫√± ]*", placeholder: "" }).mask([
      "#id_nombres", "#id_apellidos", "#id_estado_civil", "#id_comuna", "#id_region",
      "#id_sexo", "#id_nacionalidad", "#id_afp", "#id_salud", "#id_banco",
      "#id_tipo_cuenta", "#id_cargo", "#id_proyecto", "#id_tipo_contrato",
      "#id_nombre_contacto_emergencia", "#id_parentesco_emergencia"
    ]);

    // Letras y n√∫meros
    Inputmask({ regex: "[A-Za-z0-9√Å√â√ç√ì√ö√ë√°√©√≠√≥√∫√± ]*", placeholder: "" }).mask([
      "#id_direccion", "#id_nivel_estudios", "#id_profesion_u_oficio",
      "#id_direccion_emergencia", "#id_jornada", "#id_talla_polera",
      "#id_talla_pantalon", "#id_talla_zapato", "#id_observaciones"
    ]);

    // N√∫meros enteros
    Inputmask("integer", { allowMinus: false }).mask([
      "#id_edad", "#id_hijos", "#id_sueldo_base", "#id_bono", "#id_colacion",
      "#id_movilizacion", "#id_numero_cuenta", "#id_numero_cuenta_2"
    ]);

    // RUT (sin puntos ni guiones)
    Inputmask({ regex: "[0-9kK]{1,10}", placeholder: "" }).mask("#id_rut");

    // Tel√©fonos en formato Chile
    Inputmask("56 9 9999 9999").mask(["#id_telefono", "#id_telefono_emergencia"]);

    // Email
    Inputmask({ alias: "email", placeholder: "correo@ejemplo.com" }).mask("#id_email");
  });
</script>
{% endblock %}
